<ResourceDictionary
    x:Class="WhenPlugin.When.Options"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:rules="clr-namespace:NINA.Core.Utility.ValidationRules;assembly=NINA.Core"
    xmlns:local="clr-namespace:WhenPlugin.When" >

    <!--  This data template will be displayed in N.I.N.A. on the options->plugin tab with the datacontext of the TestPlugin instance  -->
    <!--  In order for this datatemplate to be picked correctly, the key has to follow the naming convention of <IPlugin.Name>_Options -->
    <!--  Furthermore the Resource Dictionary has to be exported via code behind export attributes  -->

    <DataTemplate x:Key="Sequencer Powerups_Options">
        <StackPanel Orientation="Vertical">

            <TextBlock Margin="0,0,0,10">
                <TextBlock.Inlines>
                    <Run FontWeight="Bold" FontSize="13pt"  Text="Global Constants (applicable in any Constant expression). Note that these are optionally per profile!" />
                </TextBlock.Inlines>
            </TextBlock>

            <StackPanel Orientation="Vertical">
                <Border
                    MinHeight="35"
                    Margin="0,20,0,0"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1">
                    <Grid  Background="{StaticResource BackgroundBrush}">
                        <ItemsControl MinHeight="40" ItemsSource="{Binding Globals.Items}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Visibility="Visible">
                                    <Path
                                        Grid.Column="0"
                                        Width="20"
                                        Height="30"
                                        Margin="5,0,0,0"
                                        Data="{Binding Icon}"
                                        Fill="{StaticResource ButtonForegroundBrush}"
                                        Stretch="Uniform" />
                                    <TextBlock VerticalAlignment="Center" Margin="12,0,0,0" Text="All Profiles" />
                                    <CheckBox
                                        MinWidth="40"
                                        Margin="0,0,0,0"
                                        VerticalAlignment="Center"
                                        IsChecked="{Binding AllProfiles, Mode=TwoWay}"
                                        ToolTip="If set, this Global Constant will apply to ALL profiles; otherwise, just for the current profile." />
                                    <TextBlock Margin="50,0,0,0" VerticalAlignment="Center" Text="Name:"/>
                                    <TextBox
                                        MinWidth="140"
                                        Margin="5,-1,10,-2"
                                        Text="{Binding Identifier}"
                                        TextAlignment="Center"
                                        VerticalAlignment="Center"/>
                                    <TextBlock VerticalAlignment="Center" Text="Value:" />
                                    <TextBox
                                        VerticalAlignment="Center"
                                        MinWidth="40"
                                        Margin="5,-2,10,-2"
                                        Text="{Binding Definition}"
                                        ToolTip=""
                                        ToolTipOpening="ShowConstants"
                                        TextAlignment="Center" />
                                    <local:SymControl Exp="{Binding Expr}"/>
                                    </StackPanel>
                                 </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </Border>
            </StackPanel>

            <StackPanel Orientation="Horizontal">
                <TextBlock VerticalAlignment="Center" Text="Roof status file: " />
                <TextBox
                    Margin="10,0,0,0"
                    MinWidth="300"
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    VerticalContentAlignment="Center">
                    <TextBox.Text>
                        <Binding Path="RoofFilePath" UpdateSourceTrigger="LostFocus">
                            <Binding.ValidationRules>
                                <rules:FileExistsOrEmptyRule />
                            </Binding.ValidationRules>
                        </Binding>
                    </TextBox.Text>
                </TextBox>
                <Button
                    Grid.Column="2"
                    Width="20"
                    Height="21"
                    Margin="5,0,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Command="{Binding OpenRoofFilePathDiagCommand}">
                    <Path
                        Margin="2,10,2,0"
                        Data="{StaticResource DotsSVG}"
                        Fill="{StaticResource ButtonForegroundBrush}"
                        Stretch="Uniform"
                        UseLayoutRounding="True" />
                </Button>
                <TextBlock Margin="15,0,0,0" VerticalAlignment="Center" Text="Open string: " ToolTip="A string to match indicating the roof is open"/>
                <TextBox Margin="10,0,0,0" MinWidth="60"  VerticalAlignment="Center" VerticalContentAlignment="Center" Text="{Binding RoofOpenString}" />
            </StackPanel>


        </StackPanel>
    </DataTemplate>

</ResourceDictionary>

<!--
    OpenHorizonFilePathDiagCommand = new RelayCommand(OpenHorizonFilePathDiag);
 
    public ICommand OpenHorizonFilePathDiagCommand { get; private set; }

      private void OpenHorizonFilePathDiag(object obj) {
          var dialog = GetFilteredFileDialog(string.Empty, string.Empty, "Horizon File|*.hrz;*.hzn;*.txt|MountWizzard4 Horizon File|*.hpts");
          if (dialog.ShowDialog() == true) {
              HorizonFilePath = dialog.FileName;
          }
      }

 
      public static Microsoft.Win32.OpenFileDialog GetFilteredFileDialog(string path, string filename, string filter) {
           Microsoft.Win32.OpenFileDialog dialog = new Microsoft.Win32.OpenFileDialog();

           if (File.Exists(path)) {
               dialog.InitialDirectory = Path.GetDirectoryName(path);
           }
           dialog.FileName = filename;
           dialog.Filter = filter;
           return dialog;
      }

   
-->
     